name: fingerprint
desc: fingerprint HTTP technology and response

report:
  final:
    - "{{.Output}}/fingerprint/{{.Workspace}}-technologies.txt"
    - "{{.Output}}/fingerprint/beautify-{{.Workspace}}-http.txt"
    - "{{.Output}}/fingerprint/{{.Workspace}}-http-overview.txt"

params:
  - inputFile: "{{.Target}}"
  - overviewThreads: '100'

pre_run:
  - CreateFolder("{{.Output}}/fingerprint")

steps:
  - required:
      - "{{.Binaries}}/httpx"
      - "{{.inputFile}}"
    commands:
      - cat {{.inputFile}} | {{.Binaries}}/httpx -t {{.overviewThreads}} -no-color -json -title -tech-detect -status-code -silent >> {{.Output}}/fingerprint/{{.Workspace}}-http-overview.txt
    scripts:
      - CleanJSONHttpx('{{.Output}}/fingerprint/{{.Workspace}}-http-overview.txt', '{{.Output}}/fingerprint/{{.Workspace}}-raw-overview.txt')
      - ExecCmd("cat {{.Output}}/fingerprint/{{.Workspace}}-raw-overview.txt | csvtk pretty --no-header-row -I -s ' | ' -W 75 > {{.Output}}/fingerprint/beautify-{{.Workspace}}-http.txt")
      - Cat('{{.Output}}/fingerprint/beautify-{{.Workspace}}-http.txt')
